<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Advanced Digital Clock Theme</title>
</head>
<body>
  <!-- FPS hint read by the uploader UI (1-30). -->
  <fps>1</fps>

  <script>
    // ========================================
    // ADVANCED DIGITAL CLOCK THEME
    // ========================================

    const themeSettings = {
      textColor: '#00ff00',           // Clock text color
      bgColor: '#000000',             // Background color
      fontSize: 35,                   // Font size (15, 20, 35, 60)
      fontFamily: 'Arial, sans-serif',
      fontWeight: 'bold',
      timeFormat: '24',               // '24' or '12' hour format
      showSeconds: true,              // Show seconds
      shadowColor: '#004400',         // Text shadow color
      shadowBlur: 2,                  // Text shadow blur amount
      glowIntensity: 0                // Text glow intensity (0-5)
    };

    // === PRESET COLOR PALETTES ===
    const colorPresets = {
      classic: { text: '#00ff00', bg: '#000000', shadow: '#004400' },  // Classic green on black
      neon: { text: '#ff00ff', bg: '#0a0014', shadow: '#ff00ff' },    // Neon purple
      ocean: { text: '#00ffff', bg: '#001a33', shadow: '#004466' },    // Ocean cyan
      sunset: { text: '#ff6b35', bg: '#1a0a00', shadow: '#663300' },   // Sunset orange
      matrix: { text: '#00ff41', bg: '#000000', shadow: '#00ff00' },    // Matrix green
      fire: { text: '#ff4500', bg: '#330000', shadow: '#ff6600' }      // Fire red
    };

    // Current color preset
    let currentPreset = 'classic';

    // Helper: Pad numbers with leading zero
    function pad(n) {
      return (n < 10 ? '0' : '') + n;
    }

    // Helper: Format time string
    function formatTime(fmt, d, showSeconds) {
      let h = d.getHours();
      let m = d.getMinutes();
      let s = d.getSeconds();
      let suffix = '';

      if (fmt === '12') {
        suffix = (h < 12) ? ' AM' : ' PM';
        h = h % 12;
        if (h === 0) h = 12;
      }

      let timeStr = pad(h) + ':' + pad(m);
      if (showSeconds) {
        timeStr += ':' + pad(s);
      }
      timeStr += suffix;

      return timeStr;
    }

    // Helper: Calculate font size based on settings
    function calculateFontSize(w, h, settings) {
      const sizeMap = { 15: 12, 20: 18, 35: 28, 60: 48 };
      const fontSize = sizeMap[settings.fontSize] || 28;
      console.log('üé® Calculated font size:', fontSize, 'for setting:', settings.fontSize);
      return Math.max(8, Math.min(fontSize, Math.floor(h * 0.6))); // Max 60% of height
    }

    // Helper: Apply text effects
    function applyTextEffects(ctx, text, x, y, settings) {
      // Shadow effect
      if (settings.shadowBlur > 0) {
        ctx.shadowColor = settings.shadowColor || '#000000';
        ctx.shadowBlur = settings.shadowBlur;
        ctx.fillText(text, x, y);
        ctx.shadowBlur = 0;
      }

      // Glow effect
      if (settings.glowIntensity > 0) {
        ctx.shadowColor = settings.textColor || '#ffffff';
        ctx.shadowBlur = settings.glowIntensity;
        ctx.fillText(text, x, y);
        ctx.shadowBlur = 0;
      }

      // Main text
      ctx.fillText(text, x, y);
    }

    // === REQUIRED THEME INITIALIZATION ===
    function themeInit() {
      console.log('üïê Advanced Digital Clock Theme Initialized');
      return {
        settings: themeSettings
      };
    }

    // === REQUIRED THEME RENDER FUNCTION ===
    function themeRender(ctx, w, h, state, t) {
      const settings = state.settings;
      const now = new Date(t || Date.now());

      console.log('üé® Theme render called - canvas:', w, 'x', h);
      console.log('üé® Settings:', settings);

      // Create gradient background
      const gradient = ctx.createLinearGradient(0, 0, w, h);
      gradient.addColorStop(0, settings.bgColor);
      gradient.addColorStop(0.5, shadeColor(settings.bgColor, -20));
      gradient.addColorStop(1, shadeColor(settings.bgColor, -40));
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, w, h);

      console.log('üé® Background rendered');

      // Add subtle scan lines effect
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.02)';
      ctx.lineWidth = 1;
      for (let y = 0; y < h; y += 2) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(w, y);
        ctx.stroke();
      }

      // Calculate center position
      const centerX = w / 2;
      const centerY = h / 2;

      // Setup text properties
      const fontSize = calculateFontSize(w, h, settings);
      ctx.font = `${settings.fontWeight} ${fontSize}px ${settings.fontFamily}`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';

      // Get time string
      const timeString = formatTime(settings.timeFormat, now, settings.showSeconds);
      console.log('üé® Rendering time:', timeString, 'at size:', fontSize, 'position:', centerX, centerY);

      // Apply text effects and draw
      ctx.fillStyle = settings.textColor;
      ctx.fillText(timeString, centerX, centerY);

      console.log('üé® Text rendered successfully');

      // Add decorative elements
      if (settings.glowIntensity > 2) {
        // Add corner accents
        ctx.strokeStyle = settings.textColor;
        ctx.lineWidth = 1;
        ctx.globalAlpha = 0.3;

        // Top-left corner
        ctx.beginPath();
        ctx.moveTo(5, 15);
        ctx.lineTo(5, 5);
        ctx.lineTo(15, 5);
        ctx.stroke();

        // Top-right corner
        ctx.beginPath();
        ctx.moveTo(w - 15, 5);
        ctx.lineTo(w - 5, 5);
        ctx.lineTo(w - 5, 15);
        ctx.stroke();

        // Bottom-left corner
        ctx.beginPath();
        ctx.moveTo(5, h - 15);
        ctx.lineTo(5, h - 5);
        ctx.lineTo(15, h - 5);
        ctx.stroke();

        // Bottom-right corner
        ctx.beginPath();
        ctx.moveTo(w - 15, h - 5);
        ctx.lineTo(w - 5, h - 5);
        ctx.lineTo(w - 5, h - 15);
        ctx.stroke();

        ctx.globalAlpha = 1.0;
      }

      console.log('üé® Theme render completed - time:', formatTime(settings.timeFormat, now, settings.showSeconds));
    }

    // Helper function to shade color
    function shadeColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }

    // === THEME CONTROL FUNCTIONS ===
    function setColorPreset(presetName) {
      if (colorPresets[presetName]) {
        const preset = colorPresets[presetName];
        themeSettings.textColor = preset.text;
        themeSettings.bgColor = preset.bg;
        themeSettings.shadowColor = preset.shadow;
        currentPreset = presetName;
      }
    }

    // Export control functions for external access
    window.themeControls = {
      setColorPreset: setColorPreset,
      getPresets: () => Object.keys(colorPresets),
      getCurrentPreset: () => currentPreset
    };

    console.log('üïê Advanced Digital Clock Theme Loaded - Ready!');
    console.log('üîß themeInit exists:', typeof themeInit);
    console.log('üé≠ themeRender exists:', typeof themeRender);
    console.log('üé® Available color presets:', Object.keys(colorPresets));
  </script>
</body>
</html>