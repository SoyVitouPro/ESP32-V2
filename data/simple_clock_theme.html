<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Simple Clock Theme</title>
  </head>
  <body>
    <!-- FPS hint read by the uploader UI (1–30). -->
    <fps>1</fps>

    <!--
      Simple Clock Theme optimized for LED displays
      - Clean, readable design with Khmer/English support
      - Automatic font sizing to fit display
      - Configurable 12/24 hour format
    -->
    <script>
      function themeInit() {
        return {
          // Basic settings
          format: '12',                   // '24' or '12'
          language: 'khmer',              // 'khmer', 'english', 'both'
          color: '#00ff00',               // LED green color
          bg: '#000000',                  // black background
          weight: 'bold'
        };
      }

      function pad(n) { return (n < 10 ? '0' : '') + n; }

      // Convert numbers to Khmer digits
      function toKhmerNumber(n) {
        const khmerDigits = ['០', '១', '២', '៣', '៤', '៥', '៦', '៧', '៨', '៩'];
        return n.toString().split('').map(d => khmerDigits[parseInt(d)] || d).join('');
      }

      function formatTime(state, d) {
        let h = d.getHours();
        let m = d.getMinutes();
        let s = d.getSeconds();
        let suffix = '';

        if (state.format === '12') {
          suffix = (h < 12) ? ' AM' : ' PM';
          h = h % 12;
          if (h === 0) h = 12;
        }

        let timeStr = '';
        if (state.language === 'khmer') {
          timeStr = toKhmerNumber(h) + ':' + toKhmerNumber(m) + ':' + toKhmerNumber(s);
        } else if (state.language === 'english') {
          timeStr = pad(h) + ':' + pad(m) + ':' + pad(s);
        } else { // both languages
          timeStr = toKhmerNumber(h) + ':' + toKhmerNumber(m) + ':' + toKhmerNumber(s);
          timeStr += ' ' + pad(h) + ':' + pad(m) + ':' + pad(s);
        }

        return timeStr + suffix;
      }

      // Calculate font size that fits the display
      function computeFontSize(ctx, w, h, text, family, weight) {
        let size = Math.max(10, Math.floor(h * 0.8));
        const padding = 8;
        const maxWidth = w - (padding * 2);
        const maxHeight = h - padding;

        for (let i = 0; i < 15; i++) {
          ctx.font = `${weight} ${size}px ${family}`;
          const m = ctx.measureText(text);
          const textW = Math.ceil(m.width);
          const textH = Math.ceil(size * 1.1);

          if (textW <= maxWidth && textH <= maxHeight) break;
          size = Math.max(10, size - 2);
        }
        return size;
      }

      function themeRender(ctx, w, h, state, t) {
        // Clear background
        ctx.fillStyle = state.bg || '#000000';
        ctx.fillRect(0, 0, w, h);

        // Get current time
        const now = new Date(t || Date.now());
        const timeText = formatTime(state, now);

        // Set font
        const family = 'Khmer OS Content, Noto Sans Khmer, system-ui, Arial, sans-serif';
        const weight = state.weight || 'bold';
        const size = computeFontSize(ctx, w, h, timeText, family, weight);

        ctx.font = `${weight} ${size}px ${family}`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillStyle = state.color || '#00ff00';

        // Draw time centered
        ctx.fillText(timeText, Math.floor(w * 0.5), Math.floor(h * 0.5));
      }
    </script>
  </body>
</html>